include:
  - docassemble.MAVirtualCourt:basic-questions.yml
---
metadata:
  title: |
    209A Plaintiff's Motion to Modify an Abuse Prevention Order
  short title: |
    209A Plaintiff's Motion to Modify
  description: |
    If the plaintiff already has a restraining order, they can ask the court to change or end it.
---
features:
  navigation: True
---
id: metadata
mandatory: True
code: |
  interview_metadata # make sure we initialize the object
  if not defined("interview_metadata['a_plaintiff_s_motion_to_modify_qc_v20009']"):
    interview_metadata.initializeObject('a_plaintiff_s_motion_to_modify_qc_v20009')
  interview_metadata['a_plaintiff_s_motion_to_modify_qc_v20009'].update({
    'title': 'Plaintiff Motion to Modify or terminate an Abuse Prevention Order - 209A',
    'short title': 'Plaintiff Motion to Modify  - 209a',
    'description': 'This tool will let you generate a Modify or terminate an Abuse Prevention Order - 209A',
    'original_form': 'https://trello-attachments.s3.amazonaws.com/5e7a59002834604886a7b4e8/5e8c829c43304d8fa27a4f31/3786ad7715e0e0e1ed786f2aab1809fc/plaintiff_s_motion_to_modify_209A.pdf',
    'allowed courts': [
      'Boston Municipal Court',
      'District Court',
      'Probate and Family Court',
      'Superior Court',
    ],
    'preferred court': 'District Court',
    'categories': [
      'Domestic Violence / Safety of self',
      'Family Law',
    ],
    'logic block variable': 'a_plaintiff_s_motion_to_modify_qc_v20009',
    'attachment block variable': 'a_plaintiff_s_motion_to_modify_qc_v20009_attachment',
    'typical role': 'plaintiff',
    'built_in_fields_used': [
      {'variable': 'plaintiff_name',
       'transformed_variable': 'str(plaintiffs[0])',
      },
      {'variable': 'defendant_name',
       'transformed_variable': 'str(defendants[0])',
      },
      {'variable': 'plaintiff_name__1',
       'transformed_variable': 'str(plaintiffs[0])',
      },
      {'variable': 'signature_date',
       'transformed_variable': 'signature_date',
      },
      {'variable': 'plaintiff_signature',
       'transformed_variable': 'plaintiffs[0].signature',
      },
      ],
    'fields': [
      {'variable': 'court_division',
       'transformed_variable': 'courts[0].division',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      {'variable': 'modify_order',
       'transformed_variable': 'modify_order',
      'field_type': 'yesno',
      },
      {'variable': 'terminate_order',
       'transformed_variable': 'terminate_order',
      'field_type': 'yesno',
      },
      {'variable': 'plaintiff_statement',
       'transformed_variable': 'plaintiffs[0].statement',
      'field_type': 'area',
      'field_data_type': 'text',
      },
      {'variable': 'understand_yes',
       'transformed_variable': 'understand_yes',
      'field_type': 'yesno',
      },
      ],
  })
---
id: interview_order_a_plaintiff_s_motion_to_modify_qc_v20009
mandatory: True
code: |
  interview_short_title = "Ask the court to change or end your 209A restraining order"
  # This is a placeholder to control logic flow in this interview
  # It was generated from interview_generator.py as an 'interview order' type question.
  basic_questions_intro_screen 
  a_plaintiff_s_motion_to_modify_qc_v20009_intro
  # Set the preferred/allowed courts for this interview
  preferred_court = interview_metadata["a_plaintiff_s_motion_to_modify_qc_v20009"]["preferred court"]
  allowed_courts = interview_metadata["a_plaintiff_s_motion_to_modify_qc_v20009"]["allowed courts"]

  # Custom code
  # Only a plaintiff can fill in this form so we'll hard-code it here
  docket_number
  # Re-implement if this form goes to the court along with address impoundment
  # users[0].address.address
  # users[0].mobile_number
  # form requires court division name
  courts[0]
  user_ask_role = 'plaintiff'
  users[0].name.first
  users.there_is_another = False 
  users.gathered = True
  other_parties[0].name.first
  other_parties.there_is_another = False 
  other_parties.gathered = True
  order_type
  if order_type == "modify": 
    what_to_modify
  reason
  understand_yes
  a_plaintiff_s_motion_to_modify_qc_v20009 = True
  
  # Standard code
  signature_date
  download_titles = [ "209a Plaintiff's Motion to Modify or Terminate an Abuse Prevention Order" ]

  a_plaintiff_s_motion_to_modify_qc_v20009_preview_question # Pre-canned preview screen
  
  users[0].states_above_true
  
  basic_questions_signature_flow
  users[0].signature
  download_form
    
  a_plaintiff_s_motion_to_modify_qc_v20009 = True
---
id: docket number
question: |
  What is the docket number?
subquestion: |
  Look at your Abuse Prevention Order. 
  
  In the middle of the top row, see the docket number the court has given your case. 
  
  What is it?
fields:
  - no label: docket_number
---
id: defendant name
question:  |
  What is the defendant's name?
fields:
  - First Name: other_parties[0].name.first
  - Middle Name: other_parties[0].name.middle
    required: False
  - Last Name: other_parties[0].name.last
  - Suffix: other_parties[0].name.suffix
    code: |
      name_suffix()
    required: False  
---
id: form to sign
# For consistency between interviews and to allow access from outside
code: |
  form_to_sign = pdf_concatenate( a_plaintiff_s_motion_to_modify_qc_v20009_attachment_preview, filename='Plaintiff Motion to Modify or Terminate an Abuse Prevention Order (Preview).pdf' )
---
id: signed form without cover page
# For consistency between interviews and to allow access from outside
code: |
  form_to_file_no_cover = pdf_concatenate( a_plaintiff_s_motion_to_modify_qc_v20009_attachment, filename='Plaintiff Motion to Modify or Terminate an Abuse Prevention Order.pdf' )
---
id: motion to modify intro
continue button field: a_plaintiff_s_motion_to_modify_qc_v20009_intro
question: |
  Ask the court to change or end your 209A restraining order
subquestion: |
  If the court issued a 209A restraining order to protect you, and
  
  you need to change the order or end it, 
  
  you can file the [Plaintiff's Motion to Modify or Terminate an Abuse Prevention Order](https://www.mass.gov/doc/plaintiffs-motion-to-modify-or-terminate-abuse-prevention-order-gl-c-209a/download).  

  Only use this motion if:
  
  1. You already have a 209A Abuse Prevention Order,
  1. You are the person who asked the court for the order and
  1. you need to:
      * change the order, **or** 
      * end it.
  
  You need a copy of your restraining order to answer the next set of questions. 
  
  Note:
  If you are the defendant in this case and you need to ask the court to change or end the order, **TODO: INSTRUCTIONS TO GO HERE**.
fields:
  - no label: is_plaintiff
    datatype: checkboxes
    none of the above: False    
    minlength: 1
    choices:
      - I am the plaintiff
    validation messages:
      minlength: |
        You cannot continue unless you are the plaintiff.
---
id: type of request
section: Type of request
question: |
  What are you asking the court to do?
fields:
  - no label: order_type
    datatype: radio
    choices:
      - End this Abuse Prevention Order.: terminate 
      - Change this Abuse Prevention Order.: modify
  - note: You can only type up to 540 characters.
    show if:
      variable: order_type
      is: modify
  - What do you need to change in this order?: what_to_modify
    input type: area
    maxlength: 540
    show if:
      variable: order_type
      is: modify
---
code: |
  what_to_modify = ""
  # This is to ensure that the length of what_to_modify can be used in another calcuation
---
id: explanation of future orders
question: |
  Please confirm that you understand this statement
subquestion: |
  % if order_type == "modify":
  I understand that, even if I change this order, I can fill out a new Abuse Prevention Order at any time if ${other_parties[0].familiar()} does any of these things:
  % else:
  I understand that, even if I end this order, I can fill out a new Abuse Prevention Order at any time if ${other_parties[0].familiar()} does any of these things:
  % endif

  - makes me **afraid** that ${ other_parties.familiar() } will seriously hurt me - physically,
  - tries to hurt me - physically, 
  - hurts me - physically,
  - threatens, pressures, or forces me to have sex.
fields:
  - no label: understand_yes
    datatype: checkboxes
    none of the above: False    
    minlength: 1
    choices:
      - I understand I can ask for a new order in the future.: Yes
    validation messages:
      minlength: |
        You cannot continue unless you confirm you understand.
---
id: reason for request
question: |
  % if order_type == "modify":
  Why do you need this change?
  % else:
  Why do you need to end this restraining order?
  % endif
fields:
  - note: You can only type up to ${1089 - len(what_to_modify)} characters.
  - no label: reason
    input type: area
    maxlength: ${1089 - len(what_to_modify)}
---
# How do we implement this? Previously, in order
# to tell the user how many characters they had left
# more effectively, we put 'what to modify' and 'reason'
# on different pages. We asked both to make sure the user
# included the 'what' part. If the user said they need to
# terminate, though, and they tap to edit on the review screen
# and change to 'modify', they need to add the 'what' part.
# How do we properly prompt them to do that once we
# have the full affidavit? We can't split the full affidavit
# back up. Maybe we delete 'what' to modify if they switch
# to 'terminate' so we can then ask 'what' and combine the two
# instead of having 'reason' separately... not sure this
# can work out cleanly.
if: order_type == "modify"
id: full affidavit
question: |
  This is your Affidavit
subquestion: |
  These are your words. Edit this statement in any way you need so that it says exactly what you need to tell the judge.  
  Once you are satisfied you have told the truth, as far as you know, tap to continue.
  
fields:
  - note: You can only type up to 1089 characters.
  - no label: full_affidavit
    input type: area
    maxlength: 1089
    default: |
      ${ what_to_modify + ". " + reason }
---
sets:
  - courts[0]
id: choose a court from list
question: |
  What court is your case in?
subquestion: |
  Look at your Abuse Prevention Order. 
  
  Underneath **your** name, see the court name. 
  
  Select that court from the list below:
fields:
  - no label: courts[0]
    datatype: object
    object labeler: |
      lambda y: y.short_label()
    choices: macourts.filter_courts(allowed_courts)
---
id: Signing under oath
question: |
  Signing under oath 
subquestion: |
  When you sign your name you are saying "{under penalty of perjury}” that what you wrote is {true to the best of your knowledge}.
  
  Do you swear under penalty of perjury that all your answers to the questions in this interview are true, to the best of your knowledge?
fields:
  - no label: users[0].states_above_true
    datatype: checkboxes
    minlength: 1
    choices:
      - I swear that my answers on this form are the truth under penalties of perjury.
    validation messages:
      minlength: |
        You cannot keep going unless you did your best to tell the truth.
terms:
  - under penalty of perjury: |
      Swearing "under penalty of perjury" means you swear your answers are true, as far as you know.  
         
      The court can punish you if your answers are not true to the best of your knowledge.  
      
      The court cannot punish you if your answers are about things you saw, heard, or felt.  
      The court cannot punish you if you have good reason to believe that your answers are true.
  - true to the best of your knowledge: |
      Something is true "to the best of your knowledge" if you were there and saw, heard, or felt it.  
      Something is true "to the best of your knowledge" if you have good reason to believe it is true.
---
id: review before signature
need: form_to_sign
continue button field: a_plaintiff_s_motion_to_modify_qc_v20009_preview_question
question: |
  Nearly finished
subquestion: |
  You are almost done! Before you sign, check the form below. 
  
  Tap on it. 
  
  It will open in a new screen so you can check it and make sure it is correct.
  
  Remember to come back to this page to go on to sign the form.
  
  ${form_to_sign }
   
  ${action_button_html( url_action('review_A_plaintiff_s_motion_to_modify'), icon='edit', label=word("Make changes") )}

progress: 95
---
id: preview
reconsider: True
attachment:
    variable name: a_plaintiff_s_motion_to_modify_qc_v20009_attachment_preview
    name: Plaintiff\'s Motion to Modify or Terminate an Abuse Prevention Order - 209a
    filename: Plaintiffs-Motion-to-Modify-209a
    pdf template file: 209A_plaintiff_s_motion_to_modify.pdf
    editable: False
    fields: 
      - "docket_number": ${ docket_number }
      - "plaintiff_name": ${ users }
      - "defendant_name": ${ other_parties }
      - "plaintiff_name__1": ${ users }
      - "court_division": ${ courts[0] }
      - "modify_order": ${ order_type == "modify" }
      - "terminate_order": ${ order_type == "terminate" }
      - "plaintiff_statement": ${ (what_to_modify + ". " + reason) if order_type == "modify" else reason }
      - "understand_yes": ${ understand_yes }
      - "signature_date": ${ signature_date }
---
id: download form
need: form_to_file_no_cover 
event: download_form
progress: 100
attachment code: a_plaintiff_s_motion_to_modify_qc_v20009_attachment
section: Download
decoration: file-download
question: |
  Review and download
subquestion: |
  ${users[0].familiar()}, now your form is ready to give to the court. 

  1. Tap the preview image below to open the form in a new window.
  1. Download, save, email, or print a copy of this form for your 
  records.
  1. Mail or take the form by hand to ${ courts[0] }.

  The Trial Court’s Emergency HelpLine is 833-91-COURT (833-912-6878). 
  
  The Emergency HelpLine is open: [BR]
  8:30am - 4:30pm, [BR]  
  Monday - Friday.
  
  ${ form_to_file_no_cover }
  
  ${action_button_html( url_action('review_A_plaintiff_s_motion_to_modify'), icon='edit', label=word("Make changes") )} 
---
id: motion to modify attachment
reconsider: True
attachment:
    variable name: a_plaintiff_s_motion_to_modify_qc_v20009_attachment
    name: Plaintiff\'s Motion to Modify or Terminate an Abuse Prevention Order - 209a
    filename: Plaintiffs-Motion-to-Modify-209a
    pdf template file: 209A_plaintiff_s_motion_to_modify.pdf
    editable: False    
    fields: 
      - "docket_number": ${ docket_number }
      - "plaintiff_name": ${ users }
      - "defendant_name": ${ other_parties }
      - "plaintiff_name__1": ${ users }
      - "court_division": ${ courts[0] }
      - "modify_order": ${ order_type == "modify" }
      - "terminate_order": ${ order_type == "terminate" }
      - "plaintiff_statement": ${ (what_to_modify + ". " + reason) if order_type == "modify" else reason }
      - "understand_yes": ${ understand_yes }
      - "signature_date": ${ signature_date }
      - "user_signature": ${ users[0].signature }
---
id: A_plaintiff_s_motion_to_modify review screen
event: review_A_plaintiff_s_motion_to_modify
question: |
  Your answers
subquestion: |
  Tap 'Edit' to change an answer.
review:
  - Edit: docket_number
    button: |
      **Docket number**: ${ docket_number } 
  - Edit: users[0].name.first
    button: |
      **Your name**:[BR]
      ${ users[0] }
  #- Edit: users[0].address.address
  #  button: |
  #    **Your address**:[BR]
  #    ${ users[0].address.block() }
  #- Edit: 
  #    - users[0].mobile_number
  #  button: |
  #    **Your contact information**:[BR]
  #    % if users[0].mobile_number: 
  #      Mobile number: ${ users[0].mobile_number }[BR]
  #    % endif
  #    % if users[0].phone_number:
  #      Other phone number: ${users[0].phone_number}[BR]
  #    % endif
  #    % if users[0].email: 
  #      Email: ${users[0].email}[BR]
  #    % endif
  #    % if users[0].other_contact_method: 
  #      Other contact method: ${users[0].other_contact_method}[BR]
  #    % endif
  - Edit: other_parties[0].name.first
    button: |
      **The defendant's name**:[BR]
      ${ other_parties[0] }
  - Edit:
      - order_type
      - reason
    button: |
      **You said you need to**:[BR]
      % if order_type == "modify":
        **Change** your Abuse Prevention Order:
        
        **What you need to change**:[BR]
        ${ what_to_modify }
      % else:
        **End** your Abuse Prevention Order.
      % endif
  - Edit: reason
    button: |
      % if order_type == "modify":
        **Your reason for **changing** your prevention order**:[BR]
      % else:
        **Your reason for **ending** your prevention order**:[BR]
      % endif
      ${ reason }
  - Edit: courts[0]
    button: |
      **Court where you filed your original order**:[BR]
      ${ courts[0] }
  - Edit: signature_date
    button: |
      **Date you will file this form with the court**:[BR]
      ${ signature_date }
  - Edit: users[0].signature
    button: |
      **Your signature**:[BR]
      ${ users[0].signature }
