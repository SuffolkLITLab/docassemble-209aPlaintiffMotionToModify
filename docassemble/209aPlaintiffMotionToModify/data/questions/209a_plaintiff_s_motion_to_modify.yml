include:
  - docassemble.MAVirtualCourt:basic-questions.yml
---
id: metadata
mandatory: True
code: |
  interview_metadata # make sure we initialize the object
  if not defined("interview_metadata['a_plaintiff_s_motion_to_modify_qc_v20009']"):
    interview_metadata.initializeObject('a_plaintiff_s_motion_to_modify_qc_v20009')
  interview_metadata['a_plaintiff_s_motion_to_modify_qc_v20009'].update({
    'title': 'Plaintiff Motion to Modify or terminate an Abuse Prevention Order - 209A',
    'short title': 'Plaintiff Motion to Modify  - 209a',
    'description': 'This tool will let you generate a Modify or terminate an Abuse Prevention Order - 209A',
    'original_form': 'https://trello-attachments.s3.amazonaws.com/5e7a59002834604886a7b4e8/5e8c829c43304d8fa27a4f31/3786ad7715e0e0e1ed786f2aab1809fc/plaintiff_s_motion_to_modify_209A.pdf',
    'allowed courts': [
      'Boston Municipal Court',
      'District Court',
      'Probate and Family Court',
      'Superior Court',
    ],
    'preferred court': 'District Court',
    'categories': [
      'Domestic Violence / Safety of self',
      'Family Law',
    ],
    'logic block variable': 'a_plaintiff_s_motion_to_modify_qc_v20009',
    'attachment block variable': 'a_plaintiff_s_motion_to_modify_qc_v20009_attachment',
    'typical role': 'plaintiff',
    'built_in_fields_used': [
      {'variable': 'plaintiff_name',
       'transformed_variable': 'str(plaintiffs[0])',
      },
      {'variable': 'defendant_name',
       'transformed_variable': 'str(defendants[0])',
      },
      {'variable': 'plaintiff_name__1',
       'transformed_variable': 'str(plaintiffs[0])',
      },
      {'variable': 'signature_date',
       'transformed_variable': 'signature_date',
      },
      {'variable': 'plaintiff_signature',
       'transformed_variable': 'plaintiffs[0].signature',
      },
      ],
    'fields': [
      {'variable': 'court_division',
       'transformed_variable': 'courts[0].division',
      'field_type': 'text',
      'field_data_type': 'text',
      },
      {'variable': 'modify_order',
       'transformed_variable': 'modify_order',
      'field_type': 'yesno',
      },
      {'variable': 'terminate_order',
       'transformed_variable': 'terminate_order',
      'field_type': 'yesno',
      },
      {'variable': 'plaintiff_statement',
       'transformed_variable': 'plaintiffs[0].statement',
      'field_type': 'area',
      'field_data_type': 'text',
      },
      {'variable': 'understand_yes',
       'transformed_variable': 'understand_yes',
      'field_type': 'yesno',
      },
      ],
  })
---
comment: |
  Notes on this code:
  - It doesn't override any basic questions
  
  TODO:
  - Can multiple plaintifs be on one form for this form? (Currently,
    that is offered as a possibility)
  - Same question for other parties (defendants) - multiples allowed?
---
id: interview_order_a_plaintiff_s_motion_to_modify_qc_v20009
mandatory: True
code: |
  # This is a placeholder to control logic flow in this interview
  # It was generated from interview_generator.py as an 'interview order' type question.
  basic_questions_intro_screen 
  a_plaintiff_s_motion_to_modify_qc_v20009_intro
  # Set the preferred/allowed courts for this interview
  preferred_court = interview_metadata["a_plaintiff_s_motion_to_modify_qc_v20009"]["preferred court"]
  allowed_courts = interview_metadata["a_plaintiff_s_motion_to_modify_qc_v20009"]["allowed courts"]

  # Custom code
  # Only a plaintiff can fill in this form so we'll hard-code it here
  user_ask_role = 'plaintiff'
  str(users[0])
  str(other_parties[0])
  courts[0].division
  modify_order
  users[0].statement
  understand_yes
  str(users[0])
  
  # Standard code
  signature_date
  a_plaintiff_s_motion_to_modify_qc_v20009_preview_question # Pre-canned preview screen
  basic_questions_signature_flow
  users[0].signature
  a_plaintiff_s_motion_to_modify_download
  download_titles = [ "209a Plaintiff's Motion to Modify or Terminate an Abuse Prevention Order" ]
  a_plaintiff_s_motion_to_modify_qc_v20009 = True
---
id: motion to modify intro
continue button field: a_plaintiff_s_motion_to_modify_qc_v20009_intro
question: |
  Plaintiff's Motion to Modify or Terminate an Abuse Prevention Order
subquestion: |
  This tool helps you to generate a *Plaintiff's Motion to Modify or Terminate Abuse
  Prevention Order* (pursuant to G.L. c. 209A).

  You should only run this tool if you are the **Plaintiff**,  that is:
  
  1. you personally have previously applied for an Abuse Prevention Order; **and**
  1. you wish to either modify your existing order, or to terminate your order.

  If you are not the plaintiff or if you are the subject of an Abuse Prevention Order, then
  **do not run this tool**.  Instead, you should **TODO: INSTRUCTIONS TO GO HERE**.
fields:
  - no label: a_plaintiff_s_motion_to_modify_qc_v20009_intro
    datatype: checkboxes
    none of the above: False    
    minlength: 1
    choices:
      - I am the plaintiff and I want to continue
    validation messages:
      minlength: |
        You cannot continue unless you are the plaintiff.
---
id: type of request
question: |
  What are you asking the Court to do?
subquestion: |
  I request that the court:
fields:
  - no label: MJFmodify_terminate
    datatype: radio
    choices:
      - modify this Abuse Prevention Order: modify
      - terminate this Abuse Prevention Order: terminate
---
code: |
  if MJFmodify_terminate == 'modify':
    terminate_order = False
    modify_order = True
  else:
    terminate_order = True
    modify_order = False
---
# TODO: If they answer 'I do not understand', can they continue?
id: explanation of future orders
question: |
  Please confirm that you understand this statement
subquestion: |
  I understand that, even if I ${ MJFmodify_terminate } this order,
  I can fill out a new Abuse Prevention Order at any time if the **Defendant** (person against whom I took out the Abuse Prevention Order):

  - harms or attempts to harm me physically; or 
  - places me in fear of imminent serious physical harm; or
  - by using force, threat, or duress makes me engage in sexual relations
fields:
  - no label: understand_yes
    datatype: checkboxes
    none of the above: False    
    minlength: 1
    choices:
      - I understand I can still make a new order in the future: Yes
    validation messages:
      minlength: |
        You cannot continue unless you confirm you understand.
---
# TODO: How do we handle things like the below mako with translations?
# Option: Hard code the intended sentences.
# Option: Make a templates that a variable is assigned to conditionally.
# I suspect the first will useful in most places.
id: reason for request
question: |
  Reasons supporting your request to ${ MJFmodify_terminate } your restraining order
subquestion: |
  Please enter the reasons why you have asked the court
  to ${ MJFmodify_terminate } your restraining order below.
fields:
  - no label: users[0].statement
    input type: area
---
id: motion to modify preview
continue button field: a_plaintiff_s_motion_to_modify_qc_v20009_preview_question
question: |
  Preview your form
subquestion: |
  Here is a preview of the form you'll sign on the next page.
  Please check that the details in the form are correct before
  you sign. 
  
   ${a_plaintiff_s_motion_to_modify_qc_v20009_attachment_preview}
---
id: motion to modify attachment preview
attachment:
    variable name: a_plaintiff_s_motion_to_modify_qc_v20009_attachment_preview
    name: Plaintiff Motion to Modify  - 209a
    filename: Plaintiffs_Motion_to_Modify__209a
    pdf template file: 209A_plaintiff_s_motion_to_modify.pdf
    editable: False
    fields: 
      - "plaintiff_name": ${ users }
      - "defendant_name": ${ other_parties }
      - "plaintiff_name__1": ${ users }
      - "signature_date": ${ signature_date }
      - "court_division": ${ courts[0] }
      - "modify_order": ${ modify_order }
      - "terminate_order": ${ terminate_order }
      - "plaintiff_statement": ${ users[0].statement }
      - "understand_yes": ${ understand_yes }
---
id: motion to modify download
event: a_plaintiff_s_motion_to_modify_download
progress: 100
question: |
  Completed Form
subquestion: |
  Your completed, signed Plaintiff Motion to Modify or Terminate an Abuse Prevention Order
  form is below.  You can download or email the form.
  
  ### Next steps
  
  1. Step 1
  1. Step 2
  
  This is a preview of your form.  Use the **PDF** link below to download a copy.  You
  can also email the form to yourself or someone else.
  
  ${a_plaintiff_s_motion_to_modify_qc_v20009_attachment }
attachment code: a_plaintiff_s_motion_to_modify_qc_v20009_attachment
---
id: motion to modify attachment
attachment:
    variable name: a_plaintiff_s_motion_to_modify_qc_v20009_attachment
    name: Plaintiff\'s Motion to Modify or Terminate Abuse Prevention Order - 209a
    filename: Plaintiffs_Motion_to_Modify__209a
    pdf template file: 209A_plaintiff_s_motion_to_modify.pdf
    editable: False    
    fields: 
      - "plaintiff_name": ${ users }
      - "defendant_name": ${ other_parties }
      - "plaintiff_name__1": ${ users }
      - "signature_date": ${ signature_date }
      - "court_division": ${ courts[0] }
      - "modify_order": ${ modify_order }
      - "terminate_order": ${ terminate_order }
      - "plaintiff_statement": ${ users[0].statement }
      - "understand_yes": ${ understand_yes }
      - "plaintiff_signature": ${ users[0].signature }
